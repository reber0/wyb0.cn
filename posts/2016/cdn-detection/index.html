<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="利用 python 来识别网站是否使用了 cdn 以及使用了那种 cdn"/>
  <meta name="author" content="Reber"/>
  
    
      <title>Python 实现 CDN 的判断 | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>Python 实现 CDN 的判断</h1>
      
<div class="post-meta">
    <time>2016-12-23</time>
    
    [<a href="/categories/Pentest">Pentest</a>](<a href="/tags/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86">信息搜集</a>)
</div>

      <div><p><img src="/img/anime/anime002.jpg" alt="银魂"></p>
<h3 id="0x00-什么是cdn">0x00 什么是CDN</h3>
<pre tabindex="0"><code>CDN的全称是Content Delivery Network，即内容分发网络。主要功能是在不同地点缓存内容，
运营商会在全国各地的节点上缓存你的网站网页，通过负载均衡技术，将用户的请求定向到最合适的
缓存服务器上去获取内容，比如说你是上海用户，你访问www.aa.com就会被重定向到上海的节点，
你是北京用户，你也访问www.aa.com，但是你会被重定向到上海的节点。
</code></pre><h3 id="0x01-判断方法">0x01 判断方法</h3>
<ul>
<li>可以查询CNAME记录，每个cdn厂商都有特有的特征串</li>
<li>查看http返回头的头部信息</li>
</ul>
<h3 id="0x02-代码">0x02 代码</h3>
<p>首先安装dnspython这个第三方模块：pip install dnspython</p>
<pre tabindex="0"><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys
import dns.resolver
import urllib2
import urlparse

class CdnCheck(object):
    def __init__(self, url):
        super(CdnCheck, self).__init__()
        self.cdninfo()
        self.url = url
        self.cnames = []
        self.headers = []

    def get_cnames(self): # get all cname
        furl = urlparse.urlparse(self.url)
        url = furl.netloc
        # print url

        rsv = dns.resolver.Resolver()
        # rsv.nameservers = [&#39;114.114.114.114&#39;]
        try:
            answer = dns.resolver.query(url,&#39;CNAME&#39;)
        except Exception as e:
            self.cnames = None
            # print &#34;ERROR: %s&#34; % e
        else:
            cname = [_.to_text() for _ in answer][0]
            self.cnames.append(cname)
            self.get_cname(cname)

    def get_cname(self,cname): # get cname
        try:
            answer = dns.resolver.query(cname,&#39;CNAME&#39;)
            cname = [_.to_text() for _ in answer][0]
            self.cnames.append(cname)
            self.get_cname(cname)
        except dns.resolver.NoAnswer:
            pass

    def get_headers(self): # get header
        try:
            resp = urllib2.urlopen(self.url)
        except Exception as e:
            self.headers = None
            # print &#34;ERROR: %s&#34; % e
        else:
            headers = str(resp.headers).lower()
            self.headers = headers

    def matched(self, context, *args): # Matching string 
        if not isinstance(context, basestring):
            context = str(context)

        func = lambda x, y: y in x
        # if any(func(context, pattern) for pattern in args):
        #     return True
        # else:
        #     return False
        for pattern in args:
            if func(context,pattern):
                return pattern
        return False

    def check(self):
        flag = None
        self.get_cnames()
        self.get_headers()
        if self.cnames:
            # print self.cnames
            flag = self.matched(self.cnames,*self.cdn[&#39;cname&#39;])
            if flag:
                return {&#39;Status&#39;:True, &#39;CDN&#39;:self.cdn[&#39;cname&#39;].get(flag)}
        if not flag and self.headers:
            flag = self.matched(self.headers,*self.cdn[&#39;headers&#39;])
            if flag:
                return {&#39;Status&#39;:True, &#39;CDN&#39;:&#39;unknown&#39;}
        return {&#39;Status&#39;:False, &#39;CNAME&#39;:self.cnames, &#39;Headers&#39;:self.headers}

    def cdninfo(self):
        self.cdn = {
            &#39;headers&#39;: set([
                &#39;via&#39;,
                &#39;x-via&#39;,
                &#39;by-360wzb&#39;,
                &#39;by-anquanbao&#39;,
                &#39;cc_cache&#39;,
                &#39;cdn cache server&#39;,
                &#39;cf-ray&#39;,
                &#39;chinacache&#39;,
                &#39;verycdn&#39;
                &#39;webcache&#39;,
                &#39;x-cacheable&#39;,
                &#39;x-fastly&#39;,
                &#39;yunjiasu&#39;,
            ]),
            &#39;cname&#39;: {
                &#39;tbcache.com&#39;:u&#39;taobao&#39;, # 应该是淘宝自己的。。。。
                &#39;tcdn.qq.com&#39;:u&#39;tcdn.qq.com&#39;, # 应该是腾讯的。。。
                &#39;00cdn.com&#39;:u&#39;XYcdn&#39;, # 星域cdn
                &#39;21cvcdn.com&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;21okglb.cn&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;21speedcdn.com&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;21vianet.com.cn&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;21vokglb.cn&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;360wzb.com&#39;:u&#39;360&#39;, # 360网站卫士
                &#39;51cdn.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;acadn.com&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;aicdn.com&#39;:u&#39;UPYUN&#39;, # 又拍云
                &#39;akadns.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;akamai-staging.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;akamai.com&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;akamai.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;akamaitech.net&#39;:u&#39;Akamai&#39;, # 易通锐进
                &#39;akamaized.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;alicloudlayer.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;alikunlun.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;aliyun-inc.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;aliyuncs.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;amazonaws.com&#39;:u&#39;Amazon Cloudfront&#39;, # 亚马逊
                &#39;anankecdn.com.br&#39;:u&#39;Ananke&#39;, # Ananke
                &#39;aodianyun.com&#39;:u&#39;VOD&#39;, # 奥点云
                &#39;aqb.so&#39;:u&#39;AnQuanBao&#39;, # 安全宝
                &#39;awsdns&#39;:u&#39;KeyCDN&#39;, # KeyCDN
                &#39;azioncdn.net&#39;:u&#39;Azion&#39;, # Azion
                &#39;azureedge.net&#39;:u&#39;Azure CDN&#39;, # Microsoft Azure
                &#39;bdydns.com&#39;:u&#39;Baiduyun&#39;, # 百度云
                &#39;bitgravity.com&#39;:u&#39;Tata Communications&#39;, # 待定
                &#39;cachecn.com&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;cachefly.net&#39;:u&#39;Cachefly&#39;, # Cachefly
                &#39;ccgslb.com&#39;:u&#39;ChinaCache&#39;, # 蓝汛科技
                &#39;ccgslb.net&#39;:u&#39;ChinaCache&#39;, # 蓝汛科技
                &#39;cdn-cdn.net&#39;:u&#39;&#39;, # 待定
                &#39;cdn.cloudflare.net&#39;:u&#39;CloudFlare&#39;, # CloudFlare
                &#39;cdn.dnsv1.com&#39;:u&#39;Tengxunyun&#39;, # 腾讯云
                &#39;cdn.ngenix.net&#39;:u&#39;&#39;, # 待定
                &#39;cdn20.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;cdn77.net&#39;:u&#39;CDN77&#39;, # CDN77
                &#39;cdn77.org&#39;:u&#39;CDN77&#39;, # CDN77
                &#39;cdnetworks.net&#39;:u&#39;CDNetworks&#39;, # 同兴万点
                &#39;cdnify.io&#39;:u&#39;CDNify&#39;, # CDNify
                &#39;cdnnetworks.com&#39;:u&#39;CDNetworks&#39;, # 同兴万点
                &#39;cdnsun.net&#39;:u&#39;CDNsun&#39;, # CDNsun
                &#39;cdntip.com&#39;:u&#39;QCloud&#39;, # 腾讯云
                &#39;cdnudns.com&#39;:u&#39;PowerLeader&#39;, # 宝腾互联
                &#39;cdnvideo.ru&#39;:u&#39;CDNvideo&#39;, # CDNvideo
                &#39;cdnzz.net&#39;:u&#39;SuZhi&#39;, # 速致
                &#39;chinacache.net&#39;:u&#39;ChinaCache&#39;, # 蓝汛科技
                &#39;chinaidns.net&#39;:u&#39;LineFuture&#39;, # 澜景网络
                &#39;chinanetcenter.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;cloudcdn.net&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;cloudfront.net&#39;:u&#39;Amazon Cloudfront&#39;, # Amazon
                &#39;customcdn.cn&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;customcdn.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;dnion.com&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;dnspao.com&#39;:u&#39;&#39;, # 待定
                &#39;edgecastcdn.net&#39;:u&#39;EdgeCast&#39;, # EdgeCast
                &#39;edgesuite.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;ewcache.com&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;fastcache.com&#39;:u&#39;FastCache&#39;, # 速网科技
                &#39;fastcdn.cn&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;fastly.net&#39;:u&#39;Fastly&#39;, # Fastly
                &#39;fastweb.com&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;fastwebcdn.com&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;footprint.net&#39;:u&#39;Level3&#39;, # Level3
                &#39;fpbns.net&#39;:u&#39;Level3&#39;, # Level3
                &#39;fwcdn.com&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;fwdns.net&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;globalcdn.cn&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;hacdn.net&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;hadns.net&#39;:u&#39;CnKuai&#39;, # 快网
                &#39;hichina.com&#39;:u&#39;WWW&#39;, # 万网
                &#39;hichina.net&#39;:u&#39;WWW&#39;, # 万网
                &#39;hwcdn.net&#39;:u&#39;Highwinds&#39;, # Highwinds
                &#39;incapdns.net&#39;:u&#39;Incapsula&#39;, # Incapsula
                &#39;internapcdn.net&#39;:u&#39;Internap&#39;, # Internap
                &#39;jiashule.com&#39;:u&#39;Jiasule&#39;, # 加速乐
                &#39;kunlun.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;kunlunar.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;kunlunca.com&#39;:u&#39;ALiyun&#39;, # 阿里云
                &#39;kxcdn.com&#39;:u&#39;KeyCDN&#39;, # KeyCDN
                &#39;lswcdn.net&#39;:u&#39;Leaseweb&#39;, # Leaseweb
                &#39;lxcdn.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;lxdns.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;mwcloudcdn.com&#39;:u&#39;QUANTIL&#39;, # QUANTIL
                &#39;netdna-cdn.com&#39;:u&#39;MaxCDN&#39;, # MaxCDN
                &#39;okcdn.com&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;okglb.com&#39;:u&#39;21Vianet&#39;, # 世纪互联
                &#39;ourwebcdn.net&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;ourwebpic.com&#39;:u&#39;ChinaCache&#39;, # 网宿科技
                &#39;presscdn.com&#39;:u&#39;Presscdn&#39;, # Presscdn
                &#39;qingcdn.com&#39;:u&#39;&#39;, # 待定
                &#39;qiniudns.com&#39;:u&#39;QiNiu&#39;, # 七牛云
                &#39;skyparkcdn.net&#39;:u&#39;&#39;, # 待定
                &#39;speedcdns.com&#39;:u&#39;QUANTIL&#39;, # QUANTIL
                &#39;sprycdn.com&#39;:u&#39;PowerLeader&#39;, # 宝腾互联
                &#39;tlgslb.com&#39;:u&#39;Dnion&#39;, # 帝联科技
                &#39;txcdn.cn&#39;:u&#39;CDNetworks&#39;, # 同兴万点
                &#39;txnetworks.cn&#39;:u&#39;CDNetworks&#39;, # 同兴万点
                &#39;ucloud.cn&#39;:u&#39;UCloud&#39;, # UCloud
                &#39;unicache.com&#39;:u&#39;LineFuture&#39;, # 澜景网络
                &#39;verygslb.com&#39;:u&#39;VeryCloud&#39;, # 云端网络
                &#39;vo.llnwd.net&#39;:u&#39;Limelight&#39;, # Limelight
                &#39;wscdns.com&#39;:u&#39;ChinaNetCenter&#39;, # 网宿科技
                &#39;wscloudcdn.com&#39;:u&#39;ChinaNetCenter&#39;, # 网宿科技
                &#39;xgslb.net&#39;:u&#39;Webluker&#39;, # WebLuker
                &#39;ytcdn.net&#39;:u&#39;Akamai&#39;, # Akamai
                &#39;yunjiasu-cdn&#39;:u&#39;Baiduyun&#39;, # 百度云加速
            }
        }


if __name__ == &#39;__main__&#39;:
    # url = &#34;http://www.reber.com&#34;
    url = sys.argv[1]
    cdn = CdnCheck(url)
    print cdn.check()
</code></pre><h3 id="0x03-结果">0x03 结果</h3>
<pre tabindex="0"><code>结果如下：
C:\Users\reber\Desktop&gt;python check_cdn.py http://www.reber.com
{&#39;Status&#39;: True, &#39;CDN&#39;: u&#39;Baiduyun&#39;}

C:\Users\reber\Desktop&gt;python check_cdn.py http://v.ifeng.com
{&#39;Status&#39;: True, &#39;CDN&#39;: u&#39;ChinaCache&#39;}
</code></pre></div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         • 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2023
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    based on the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
