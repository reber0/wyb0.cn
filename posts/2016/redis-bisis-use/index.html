<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content=""/>
  <meta name="author" content="Reber"/>
  
    
      <title>一次存储型 XSS 利用实例 | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>一次存储型 XSS 利用实例</h1>
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2016-08-03</time>
    <span>in</span>
    
      <a href="/categories/Server">Server</a>, 
      <a href="/categories/Database">Database</a>
  </strong>
  <span> • 1728 words</span>
  
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/server">server</a>, 
        <a href="/tags/redis">redis</a>
    </div>
  
</div>

      <div>

<h3 id="0x00-关于redis">0x00 关于Redis</h3>

<pre><code>Redis和MySQL这种关系型数据库不一样，它是非关系型数据库，是日志型、Key-Value数据库，
实现了master-slave(主从)同步,数据都是缓存在内存中的,所以可高速读写,但存储成本较高,
不适合做海量数据存储。
</code></pre>

<h3 id="0x01-安装">0x01 安装</h3>

<ul>
<li><p>Linux下安装Redis
可在<a href="http://download.redis.io/releases/">http://download.redis.io/releases/</a> 下载</p>

<pre><code>$ cd /opt
$ wget http://download.redis.io/releases/redis-3.2.3.tar.gz
$ tar -zxvf redis-3.2.3.tar.gz
$ cd redis-3.2.3
$ make
$ make install
</code></pre></li>

<li><p>Windows下安装Redis
下载：<a href="https://github.com/MSOpenTech/redis/releases" target="_blank">点此下载</a></p></li>
</ul>

<p>安装后添加环境变量</p>

<pre><code>添加为系统服务：
redis-server.exe --service-install redis.windows.conf --loglevel verbose

启动服务：
redis-server.exe --service-start

关闭服务：
redis-server.exe --service-stop

为Redis添加密码：
打开安装目录下的文件redis.windows-service.conf，
找到requirepass，配置为requirepass mypassword，然后重启redis
此时仍然可以连接上，但是执行命令时会提示没权限

带密码连接Redis：
redis-cli.exe -h 127.0.0.1 -p 6379 -a mypassword
</code></pre>

<h3 id="0x02-产生的可执行文件">0x02 产生的可执行文件</h3>

<pre><code>redis-server：redis服务器启动程序
redis-cli：redis命令行工具，也可为客户端
redis-stat：redis状态检测工具
redis-benchmark：redis性能检测工具(读写)
</code></pre>

<h3 id="0x03-配置文件">0x03 配置文件</h3>

<pre><code>$ vim /opt/redis-3.2.3/redis.conf
  daemonize yes  # 当值为yes时可以后台运行
  bind 127.0.0.1  # 绑定ip，配置后只接受来自该ip的请求
  port 6379  # 监听端口
  timeout 300 # 客户端连接超时时间，单位为秒
  loglevel notice  # 日志等级分为4级，debug、verbose、notice、warning
  logfile &quot;/var/log/redis.log&quot;  # 日志文件位置
  databases 16  # 数据库数量
  sava 900 1  # 设置数据库镜像的频率
  dbfilename dump.rdb  # 镜像备份文件的名字
  dir ./ 数据库镜像备份保存路径
  # slaveof &lt;masterip&gt; &lt;masterport&gt;  # 设置这个redis为从服务器
  # masterauth &lt;master-password&gt;  # 主服务器连接需要的密码验证
  # requirepass 123456  # 登陆时的密码
  maxclients 10000  # 最大连接的客户数量
  # mexmemory &lt;bytes&gt;  # redis能够使用的最大内存
  appendonly no  # 可以设置是否只能追加
</code></pre>

<h3 id="0x04-启动测试">0x04 启动测试</h3>

<pre><code>本地启动：
$ redis-server /opt/redis-3.2.3/redis.conf  # 启动服务
$ ps -aux | grep redis
</code></pre>

<pre><code class="language-cs"># 客户端连接
$ redis-cli

# 连接远程redis
$ redis-cli -h host -p port -a password
/*
$ redis-cli -h host -p port
127.0.0.1:6379&gt; keys *
(error) NOAUTH Authentication required.
127.0.0.1:6379&gt; auth password
OK
*/

# 查看所有键值
127.0.0.1:6379&gt; keys *

# 选择数据库
127.0.0.1:6379&gt; select 0 #可以选择0～15

# 获取redis安装目录
127.0.0.1:6379&gt; config get dir
1) &quot;dir&quot;
2) &quot;/var/lib/redis&quot;

# 备份(恢复数据时只需要将备份文件放在redis安装目录即可)
127.0.0.1:6379&gt; save
OK
127.0.0.1:6379&gt; exit
</code></pre>

<h3 id="0x06-数据类型">0x06 数据类型</h3>

<ul>
<li><p>String(字符串)</p>

<ul>
<li>string是redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</li>
<li>string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象。</li>

<li><p>string类型是Redis最基本的数据类型，一个键最大能存储512MB。</p>

<pre><code class="language-cs"># 添加键值对
127.0.0.1:6379&gt; set name &quot;xiaoming&quot;
# 获取键值
127.0.0.1:6379&gt; get name
# 删除键值对
127.0.0.1:6379&gt; del name
</code></pre></li>
</ul></li>

<li><p>Hash(哈希)</p>

<ul>
<li>Redis hash 是一个键名对集合。</li>

<li><p>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p>

<pre><code class="language-cs"># Hash中一个key对应多个值
127.0.0.1:6379&gt; hmset student1 name &quot;xiaohong&quot; age &quot;18&quot;
OK
127.0.0.1:6379&gt; hmset student2 name &quot;xiaoliu&quot; age &quot;23&quot;
OK
127.0.0.1:6379&gt; hgetall student1
1) &quot;name&quot;
2) &quot;xiaohong&quot;
3) &quot;age&quot;
4) &quot;18&quot;
127.0.0.1:6379&gt; hgetall student2
1) &quot;name&quot;
2) &quot;xiaoliu&quot;
3) &quot;age&quot;
4) &quot;23&quot;
</code></pre></li>
</ul></li>

<li><p>List(列表)</p>

<ul>
<li>Redis 列表是简单的字符串列表，按照插入顺序排序。</li>

<li><p>可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>

<pre><code class="language-cs"># 字符串列表
127.0.0.1:6379&gt; lpush list1 &quot;python&quot;
(integer) 1
127.0.0.1:6379&gt; lpush list1 &quot;php&quot;
(integer) 2
127.0.0.1:6379&gt; lpush list1 &quot;asp&quot;
(integer) 3
127.0.0.1:6379&gt; lpush list1 &quot;jsp&quot;
(integer) 4
127.0.0.1:6379&gt; rpush list2 &quot;aaaa&quot;
(integer) 1
127.0.0.1:6379&gt; rpush list1 &quot;aaaa&quot;
(integer) 5
127.0.0.1:6379&gt; lrange list1 0 10
1) &quot;jsp&quot;
2) &quot;asp&quot;
3) &quot;php&quot;
4) &quot;python&quot;
5) &quot;aaaa&quot;
127.0.0.1:6379&gt; lindex list1 3
&quot;python&quot;
127.0.0.1:6379&gt; llen list1
(integer) 5
127.0.0.1:6379&gt; lpop list1
&quot;jsp&quot;
127.0.0.1:6379&gt; rpop list1
&quot;aaaa&quot;
</code></pre></li>
</ul></li>

<li><p>Set(集合)</p>

<ul>
<li>Redis的Set是string类型的无序集合。</li>
<li>集合内元素是唯一的，后者会覆盖前者。</li>

<li><p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p>

<pre><code class="language-cs"># String类型的无序集合
127.0.0.1:6379&gt; sadd set1 &quot;333&quot;
(integer) 1
127.0.0.1:6379&gt; sadd set1 &quot;222&quot;
(integer) 1
127.0.0.1:6379&gt; sadd set1 &quot;111&quot;
(integer) 1
127.0.0.1:6379&gt; sadd set1 &quot;111&quot;
(integer) 0
127.0.0.1:6379&gt; sadd set1 &quot;000&quot;
(integer) 1
127.0.0.1:6379&gt; smembers set1
1) &quot;000&quot;
2) &quot;222&quot;
3) &quot;333&quot;
4) &quot;111&quot;
</code></pre></li>
</ul></li>

<li><p>zset(有序集合)</p>

<ul>
<li>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。</li>
<li>zset每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</li>

<li><p>zset的成员是唯一的,但分数(score)却可以重复。</p>

<pre><code class="language-cs"># String类型的有序集合
127.0.0.1:6379&gt; zadd zset1 2 &quot;222&quot;
(integer) 1
127.0.0.1:6379&gt; zadd zset1 1 &quot;111&quot;
(integer) 1
127.0.0.1:6379&gt; zadd zset1 3 &quot;333&quot;
(integer) 1
127.0.0.1:6379&gt; zadd zset1 3 &quot;333&quot;
(integer) 0
127.0.0.1:6379&gt; zadd zset1 0 &quot;000&quot;
(integer) 1
127.0.0.1:6379&gt; zrange zset1 0 10
1) &quot;000&quot;
2) &quot;111&quot;
3) &quot;222&quot;
4) &quot;333&quot;
127.0.0.1:6379&gt; zadd zset1 0 &quot;555&quot;
(integer) 1
127.0.0.1:6379&gt; zrange zset1 0 10
1) &quot;000&quot;
2) &quot;555&quot;
3) &quot;111&quot;
4) &quot;222&quot;
5) &quot;333&quot;
127.0.0.1:6379&gt; zrange zset1 0 10 withscores
1) &quot;000&quot;
2) &quot;0&quot;
3) &quot;555&quot;
4) &quot;0&quot;
5) &quot;111&quot;
6) &quot;1&quot;
7) &quot;222&quot;
8) &quot;2&quot;
9) &quot;333&quot;
10) &quot;3&quot;
</code></pre></li>
</ul></li>
</ul>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      <br />
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         | 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2022
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    using the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
