<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content=""/>
  <meta name="author" content="Reber"/>
  
    
      <title>使用 Python 读写 xml 文件 | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>使用 Python 读写 xml 文件</h1>
      
<div class="post-meta">
    <time>2017-07-20</time>
    
    [<a href="/categories/Python">Python</a>](<a href="/tags/python">python</a>,<a href="/tags/xml">xml</a>)
</div>

      <div>

<h3 id="0x00-解析xml的方法">0x00 解析XML的方法</h3>

<ol>
<li><p>SAX (simple API for XML)<br />
python 标准库包含SAX解析器，SAX用事件驱动模型，通过在解析XML的过程中触发一个个的事件并调用用户定义的回调函数来处理XML文件。</p></li>

<li><p>DOM(Document Object Model)<br />
将XML数据在内存中解析成一个树，通过对树的操作来操作XML。</p></li>

<li><p>ElementTree(元素树)<br />
ElementTree就像一个轻量级的DOM，具有方便友好的API。代码可用性好，速度快，消耗内存少。</p></li>
</ol>

<ul>
<li><strong>我在这里使用ElementTree</strong></li>
</ul>

<h3 id="0x01-element对象的属性">0x01 Element对象的属性</h3>

<p>每个Element对象都具有以下属性：</p>

<ul>
<li>tag：string对象，表示数据代表的种类</li>
<li>attrib：dictionary对象，表示附有的属性</li>
<li>text：string对象，表示element的内容</li>
<li>tail：string对象，表示element闭合之后的尾迹</li>
<li>若干子元素（child elements）</li>
</ul>

<pre><code class="language-python">&gt;&gt;&gt; from xml.etree import ElementTree as ET
&gt;&gt;&gt; xml = &quot;&quot;&quot;&lt;books&gt;
...   &lt;book id='37476'&gt;aaaa&lt;/book&gt;
...   &lt;book id='83727'&gt;bbbb&lt;/book&gt;
... &lt;/books&gt;&quot;&quot;&quot;
&gt;&gt;&gt; root = ET.fromstring(xml)
&gt;&gt;&gt; root.tag
'books'
&gt;&gt;&gt; child = root.getchildren()
&gt;&gt;&gt; child
[&lt;Element 'book' at 0x106f59410&gt;, &lt;Element 'book' at 0x106f59450&gt;]
&gt;&gt;&gt; child[0].tag
'book'
&gt;&gt;&gt; child[0].attrib
{'id': '37476'}
&gt;&gt;&gt; child[0].text
'aaaa'
</code></pre>

<h3 id="0x02-文件内容">0x02 文件内容</h3>

<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;books&gt;
  &lt;book&gt;
    &lt;name&gt;Python黑帽子&lt;/name&gt;
    &lt;date&gt;2015&lt;/date&gt;
    &lt;price&gt;37￥&lt;/price&gt;
    &lt;description&gt;用python写一些程序&lt;/description&gt;
  &lt;/book&gt;
  &lt;book&gt;
    &lt;name&gt;Web安全深度剖析&lt;/name&gt;
    &lt;date&gt;2014&lt;/date&gt;
    &lt;price&gt;39￥&lt;/price&gt;
    &lt;description&gt;讲述web渗透的基础知识&lt;/description&gt;
  &lt;/book&gt;
  &lt;book&gt;
    &lt;name&gt;白帽子讲web安全&lt;/name&gt;
    &lt;date&gt;2013&lt;/date&gt;
    &lt;price&gt;44￥&lt;/price&gt;
    &lt;description&gt;道哥力作&lt;/description&gt;
  &lt;/book&gt;
&lt;/books&gt;
</code></pre>

<h3 id="0x03-读取xml节点">0x03 读取xml节点</h3>

<pre><code class="language-python">#!/usr/bin/env python
# -*- coding: utf-8 -*-

from xml.etree import ElementTree as ET

tree = ET.parse('test.xml')
root = tree.getroot()
# root = ET.fromstring(country_data_as_string) #通过字符串导入,直接获取根
childs = root.getchildren()

books = []
for child0 in childs:
    book = {}
    for child00 in child0.getchildren():
        # print child00.tag #标签名，即name、date、price、description
        # print child00.text
        book[child00.tag] = child00.text
    books.append(book)

print books
&quot;&quot;&quot;
books = [
    {'name': 'Python黑帽子','date': '2015','price': '37￥','description': '用python写一些程序'},
    {'name': 'Web安全深度剖析','date': '2014','price': '39￥','description': '讲述web渗透的基础知识'},
    {'name': '白帽子讲web安全','date': '2013','price': '44￥','description': '道哥力作'}        
]
&quot;&quot;&quot;
</code></pre>

<h3 id="0x04-写入xml文件">0x04 写入xml文件</h3>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-
# code by reber &lt;1070018473@qq.com&gt;

from xml.etree import ElementTree as ET

bs = [
    {
        'name': u'Python黑帽子',
        'date': '2015',
        'price': u'37￥',
        'description': u'用python写一些程序'
    },
    {
        'name': u'Web安全深度剖析',
        'date': '2014',
        'price': u'39￥',
        'description': u'讲述web渗透的基础知识'
    },
    {
        'name': u'白帽子讲web安全',
        'date': '2013',
        'price': u'44￥',
        'description': u'道哥力作'
    }        
]

def indent(elem, level=0):
    &quot;&quot;&quot;美化写入文件的内容&quot;&quot;&quot;
    i = &quot;\n&quot; + level*&quot;  &quot;
    if len(elem):
        if not elem.text or not elem.text.strip():
            elem.text = i + &quot;  &quot;
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
        for elem in elem:
            indent(elem, level+1)
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
    else:
        if level and (not elem.tail or not elem.tail.strip()):
            elem.tail = i

books = ET.Element('books')

# for b in bs:
#     book = ET.Element('book')
#     books.append(book)

#     for k,v in b.items():
#         child = ET.Element(k)
#         child.text = v
#         book.append(child)

for b in bs:
    book = ET.SubElement(books, 'book')
    for k,v in b.items():
        ET.SubElement(book, k).text = v

indent(books,0)

tree = ET.ElementTree(books)
tree.write('aa.xml', 'utf-8')
# import sys
# tree.write(sys.stdout)
</code></pre>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         • 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2022
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    based on the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
